<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Clickable Map</title>
    <style>
        body {
            display: flex;
        }
        #map-container {
            flex: 1;
            border: 1px solid #ccc;
        }
        #selected-municipalities {
            flex: 0 0 300px;
            margin-left: 20px;
            border: 1px solid #ccc;
            padding: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .clicked {
            fill: red; /* Change this to your desired highlight color */
        }
        #controls {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div id="map-container"></div>
    <div id="selected-municipalities">
        <div id="controls">
            <button id="save-district">Save District</button>
            <button id="load-district">Load District</button>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mapContainer = document.getElementById('map-container');
            const selectedMunicipalitiesContainer = document.getElementById('selected-municipalities');
            const saveButton = document.getElementById('save-district');
            const loadButton = document.getElementById('load-district');

            const SELECTED_DISTRICT_KEY = 'selectedDistrict';

            // Load the SVG file using an AJAX request
            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'sc.svg', true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    mapContainer.innerHTML = xhr.responseText;

                    // Get the SVG map element
                    const map = document.querySelector('svg');

                    // Load the CSV file using another AJAX request
                    const csvXhr = new XMLHttpRequest();
                    csvXhr.open('GET', 'municipalities.csv', true);
                    csvXhr.onreadystatechange = function() {
                        if (csvXhr.readyState === 4 && csvXhr.status === 200) {
                            const csvData = csvXhr.responseText;
                            const municipalitiesData = parseCSV(csvData);

                            // Object to store selected municipalities
                            const selectedMunicipalities = {};

                            // Add click event listener to the map
                            map.addEventListener('click', function(event) {
                                const clickedPath = event.target;
                                const municipalityId = clickedPath.id;
                                const municipalityData = municipalitiesData[municipalityId];

                                if (municipalityData) {
                                    clickedPath.classList.toggle('clicked');

                                    if (selectedMunicipalities[municipalityId]) {
                                        delete selectedMunicipalities[municipalityId];
                                    } else {
                                        selectedMunicipalities[municipalityId] = municipalityData;
                                    }

                                    updateSelectedMunicipalitiesDisplay(selectedMunicipalities);
                                }
                            });

                            saveButton.addEventListener('click', function() {
                                saveDistrict(selectedMunicipalities);
                            });

                            loadButton.addEventListener('click', function() {
                                loadDistrict(map, municipalitiesData, selectedMunicipalities);
                            });
                        }
                    };
                    csvXhr.send();
                }
            };
            xhr.send();

            function parseCSV(csv) {
                const lines = csv.split('\n');
                const municipalities = {};

                for (let i = 1; i < lines.length; i++) {
                    const [name, population, , id] = lines[i].split(',');

                    if (id) {
                        municipalities[id.trim()] = {
                            name: name.trim(),
                            population: parseInt(population.trim(), 10)
                        };
                    }
                }

                return municipalities;
            }

            function updateSelectedMunicipalitiesDisplay(selectedMunicipalities) {
                let totalPopulation = 0;
                const listItems = [];

                for (const id in selectedMunicipalities) {
                    const municipality = selectedMunicipalities[id];
                    totalPopulation += municipality.population;
                    listItems.push(`<li>${municipality.name} (Population: ${municipality.population})</li>`);
                }

                selectedMunicipalitiesContainer.innerHTML = `
                    <div id="controls">
                        <button id="save-district">Save District</button>
                        <button id="load-district">Load District</button>
                    </div>
                    <h2>Selected Municipalities</h2>
                    <p>Total Population: ${totalPopulation}</p>
                    <ul>${listItems.join('')}</ul>
                `;
            }

            function saveDistrict(selectedMunicipalities) {
                localStorage.setItem(SELECTED_DISTRICT_KEY, JSON.stringify(selectedMunicipalities));
                alert('District saved successfully!');
            }

            function loadDistrict(map, municipalitiesData, selectedMunicipalities) {
                const savedDistrict = localStorage.getItem(SELECTED_DISTRICT_KEY);
                if (savedDistrict) {
                    const district = JSON.parse(savedDistrict);
                    for (const id in district) {
                        selectedMunicipalities[id] = municipalitiesData[id];
                        const path = map.getElementById(id);
                        if (path) {
                            path.classList.add('clicked');
                        }
                    }
                    updateSelectedMunicipalitiesDisplay(selectedMunicipalities);
                } else {
                    alert('No saved district found.');
                }
            }
        });
    </script>
</body>
</html>
